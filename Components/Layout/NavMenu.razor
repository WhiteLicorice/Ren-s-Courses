@inject NavigationManager Nm

<header id="main-navbar" class="sticky top-0 z-50 w-full border-b border-borderDark bg-bgDark transition-transform duration-300">
    <div class="mx-auto flex h-16 max-w-5xl items-center justify-between px-4 sm:px-6 xl:px-0">
        
        <div class="flex lg:w-0 lg:flex-1">
            <a href="" class="-m-1.5 p-1.5">
                <div class="text-xl font-bold text-gray-100 hover:text-red-500 transition-colors">@WebsiteKeys.Title</div>
            </a>
        </div>

        <nav class="hidden space-x-6 sm:flex">
            @foreach (var item in menuItems)
            {
                <NavLink ActiveClass="text-red-400 bg-red-500/10 border border-red-500/20 rounded" 
                         class="inline-flex items-center px-3 py-1 text-sm font-medium text-gray-300 hover:text-red-400 transition-all"
                         Match="@(item.Link == "" ? NavLinkMatch.All : NavLinkMatch.Prefix)" 
                         href="@item.Link"
                         target="@item.Target">
                    @((MarkupString)item.Name)
                    @if(item.Icon != null) {
                         <span class="ml-2"><Svg Icon="item.Icon" SizeClasses="w-4 h-4" /></span>
                    }
                </NavLink>
            }
        </nav>

        <div class="flex flex-1 justify-end sm:hidden">
            <button id="toggle-button" type="button" class="-m-2.5 p-2.5 text-gray-400 hover:text-red-500">
                <span class="sr-only">Open main menu</span>
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                </svg>
            </button>
        </div>
    </div>

    <div id="mobile-menu" class="hidden fixed inset-0 z-50 bg-bgDark transition-all">
        <div class="flex items-center justify-between px-6 py-4 border-b border-borderDark">
            <span class="font-bold text-gray-100">Menu</span>
            <button id="close-mobile-menu-button" class="p-2 text-gray-400 hover:text-red-500">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <div class="mt-6 flow-root px-6">
            <div class="space-y-2 py-6">
                @foreach (var item in menuItems)
                {
                    <NavLink class="block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-100 hover:bg-red-500/10 hover:text-red-400"
                             href="@item.Link" 
                             Match="@(item.Link == "" ? NavLinkMatch.All : NavLinkMatch.Prefix)"
                             target="@item.Target">
                            <div class="flex items-center gap-2">
                            @((MarkupString)item.Name)
                            <Svg Icon="item.Icon" />
                            </div>
                    </NavLink>
                }
            </div>
        </div>
    </div>
</header>

<script>
    // Mobile Menu Logic
    const toggleMobileMenu = () => {
        const mobileMenu = document.querySelector('#mobile-menu');
        mobileMenu.classList.toggle('hidden');
        document.body.classList.toggle('overflow-hidden'); // Prevent body scroll when menu is open
    };
    document.querySelector('#toggle-button').addEventListener('click', toggleMobileMenu);
    document.querySelector('#close-mobile-menu-button').addEventListener('click', toggleMobileMenu);

    // Scroll Direction Detection (Hide/Show Navbar)
    let lastScrollTop = 0;
    const navbar = document.getElementById('main-navbar');
    
    window.addEventListener('scroll', function() {
        let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        
        // Prevent negative scrolling (iOS bounce) causing issues
        if (scrollTop < 0) return;

        if (scrollTop > lastScrollTop && scrollTop > 100) {
            // Scroll DOWN -> Hide Navbar
            navbar.classList.add('-translate-y-full');
        } else {
            // Scroll UP -> Show Navbar
            navbar.classList.remove('-translate-y-full');
        }
        lastScrollTop = scrollTop;
    });
</script>

@code {
    List<MenuItem> menuItems =
    [
        new("Home", "", null, "_self"),
        new("Materials", "tags", null, "_self"),
        new("Submissions", "https://forms.gle/mRFBXwhuR3LdvSN3A", null, "_blank"),
        new("Grades", "https://script.google.com/a/macros/up.edu.ph/s/AKfycbzDek55-JQ1pRgdjQsj8Xoe3CMA-LCwt4ARG3f7SCoskOwsVfIhY0ztXSLVLOfH0i_smw/exec", null, "_blank"),
        new("", WebsiteKeys.GitHubRepo, Svg.Icons.Github, "_blank")
    ];  

    // Updated Record to include Target
    record MenuItem(string Name, string Link, Svg.Icons? Icon, string Target);
}