@page "/projects"
@page "/projects/{TagName?}"
@using BlazorStatic
@using BlazorStatic.Services
@using BlazorStaticMinimalBlog.Models
@inject BlazorStaticContentService<ProjectFrontMatter> projectService

<div class="mx-auto max-w-6xl py-10 sm:py-16 animate-fade-in">

    @if (TagName == null)
    {
        @* VIEW 1: CATALOG (Tag Cloud) *@
        <div class="text-center mb-12">
            <h1 class="text-3xl font-bold tracking-tight text-text-main sm:text-5xl mb-4 font-mono">
                <span class="text-accent">./</span>Showcase
            </h1>
            <p class="text-text-dim max-w-2xl mx-auto">
                Browse projects built by my students.
            </p>
            <div class="mt-12 mb-12 w-full h-px bg-gradient-to-r from-transparent via-accent/50 to-transparent"></div>
        </div>


        @* Use the Generic Component *@
        @* T="ProjectFrontMatter" is the key difference from Materials.razor *@
        <CatalogsList T="ProjectFrontMatter" Posts="projectService.Posts" BaseUrl="projects" />
    }
    else
    {
        @* VIEW 2: FILTERED LIST *@
        <div>
            <div class="text-center mb-12">
                <div class="flex justify-center mb-6">
                    <a href="projects"
                        class="inline-flex items-center gap-2 text-sm text-text-dim hover:text-accent transition-colors group">
                        <svg class="w-4 h-4 transition-transform group-hover:-translate-x-1" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        All Projects
                    </a>
                </div>

                <div class="text-center mb-12">
                    <h1 class="text-3xl font-bold tracking-tight text-text-main sm:text-5xl mb-4 font-mono">
                        <span class="text-accent">#</span>@TagName
                    </h1>
                    <p class="text-text-dim max-w-2xl mx-auto">
                        Displaying <span class="text-text-main font-semibold">@filteredPosts?.Count</span> projects.
                    </p>
                    <div class="mt-12 mb-12 w-full h-px bg-gradient-to-r from-transparent via-accent/50 to-transparent">
                    </div>
                </div>
            </div>

            <ProjectsList Posts="filteredPosts" />

            <div class="mt-16 pt-8 border-t border-border-muted flex justify-center">
                <a href="projects"
                    class="px-6 py-2 rounded border border-border-muted text-sm font-medium text-text-dim hover:border-accent hover:text-accent transition-all">
                    View Other Projects
                </a>
            </div>
        </div>
    }
</div>

@code {
    [Parameter] public string? TagName { get; set; }
    List<Post<ProjectFrontMatter>>? filteredPosts;

    protected override void OnInitialized()
    {
        if (!string.IsNullOrWhiteSpace(TagName))
        {
            // Filter logic specific to projects
            filteredPosts = projectService.Posts
            .Where(x => x.FrontMatter.Tags != null && x.FrontMatter.Tags.Contains(TagName))
            .OrderBy(x => x.FrontMatter.Title)
            .ToList();
        }
    }
}